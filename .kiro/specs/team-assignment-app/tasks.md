# 実装計画

## タスク概要

このドキュメントは、チーム分けアプリの実装タスクを定義します。全要件をカバーし、段階的に機能を構築していきます。

## タスクリスト

- [ ] 1. プロジェクト基盤構築
- [x] 1.1 (P) HTML 構造とスタイルシート基盤を作成

  - index.html にセマンティック HTML 要素を配置(header, main, section)
  - style.css に CSS カスタムプロパティ(`--primary-color: #2196F3`)とリセットスタイルを定義
  - レスポンシブデザイン用のメディアクエリ設定
  - Flexbox/Grid レイアウトの基本構造を実装
  - _Requirements: 8.1, 8.2, 9.1, 9.2_

- [x] 1.2 (P) JavaScript アプリケーション初期化構造を構築

  - app.js にアプリケーションエントリーポイントを作成
  - DOMContentLoaded イベントでアプリ初期化を実装
  - コンポーネントクラスの基本構造を定義(AppController, MemberManager, TeamAssignmentEngine, ImageExporter)
  - Result 型のヘルパー関数を実装(okResult, errorResult)
  - _Requirements: 10.1_

- [x] 2. メンバー管理機能
- [x] 2.1 MemberManager コンポーネントを実装

  - SessionStorage キー('team-assignment-members')の定義
  - initializeMembers()で初期メンバー 10 人(ひらがな 5 人、カタカナ 5 人)を初期化
  - getMembers()で SessionStorage からメンバーリストを取得
  - addMember()でメンバー追加(UUID 生成、バリデーション、SessionStorage 保存)
  - updateMember()でメンバー名編集(存在チェック、バリデーション、SessionStorage 更新)
  - deleteMember()でメンバー削除(配列から除外、SessionStorage 更新)
  - 空文字列入力の入力バリデーション
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 10.2, 10.3_

- [x] 2.2 メンバーリスト UI コンポーネントを実装

  - MemberListSection の HTML 構造を作成(テーブルまたはリスト形式)
  - 初期メンバー表示機能(DOM へのレンダリング)
  - 追加ボタンとフォーム(名前入力、種別選択)
  - 編集ボタンとインライン編集機能(名前変更)
  - 削除ボタンとメンバー削除機能
  - MemberManager とのイベント連携(追加/編集/削除時の DOM 更新)
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 8.4_

- [x] 3. チーム分けロジック
- [x] 3.1 TeamAssignmentEngine コンポーネントを実装

  - Fisher-Yates シャッフルアルゴリズムを実装(shuffle 関数)
  - distributeByTeamCount()でチーム数指定モードを実装(均等分配、余りランダム配分)
  - distributeByTeamSize()で 1 チーム人数指定モードを実装(端数チーム作成)
  - assignWithConstraint()で制約付きモードを実装(ひらがな/カタカナメンバーのみチーム作成、残り分配)
  - チームオブジェクト生成(UUID、チーム名、メンバー配列)
  - 入力バリデーション(チーム数、人数、制約条件)
  - _Requirements: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 4.4_

- [x] 3.2 チーム分け設定 UI コンポーネントを実装

  - SettingsSection の HTML 構造を作成(フォーム、ラジオボタン、入力フィールド)
  - モード選択 UI(チーム数指定/1 チーム人数指定/制約付き)
  - チーム数入力フィールド(1 以上の整数バリデーション)
  - 1 チーム人数入力フィールド(1 以上の整数バリデーション)
  - 制約設定 UI(ひらがな/カタカナ選択、人数指定、0 以上の整数バリデーション)
  - モード切り替え時の入力フィールド表示/非表示制御
  - _Requirements: 2.1, 3.1, 4.1, 4.2, 8.4_

- [ ] 4. AppController とチーム分け実行フロー
- [ ] 4.1 AppController コンポーネントを実装

  - init()で DOM 要素参照取得とイベントリスナー登録
  - executeTeamAssignment()でチーム分け実行フロー(MemberManager→TeamAssignmentEngine→UI 更新)
  - チーム分け設定の収集とバリデーション(TeamAssignmentConfig 生成)
  - reExecuteTeamAssignment()で前回設定を保持し再実行
  - エラーハンドリング(Result 型処理、エラーメッセージ表示)
  - 最後の設定をメモリに保持(再抽選用)
  - _Requirements: 2.2, 2.3, 2.4, 3.2, 3.3, 3.4, 4.3, 4.4, 6.2, 6.3_

- [ ] 4.2 チーム分け実行ボタンと UI フローを実装

  - 「チーム分け実行」ボタンのイベントハンドラ
  - executeTeamAssignment()呼び出しとエラー処理
  - ローディング状態の表示(任意、8.3 で即座表示のため最小限)
  - 成功時のチーム結果表示エリア遷移
  - 失敗時のエラーメッセージ表示(フォーム下またはモーダル)
  - _Requirements: 2.4, 3.4, 4.4, 8.3, 8.4_

- [ ] 5. チーム分け結果表示
- [ ] 5.1 TeamResultSection コンポーネントを実装

  - チーム結果表示の HTML 構造を作成(リスト形式とカード形式の切り替え対応)
  - リスト形式のレンダリング(チーム名、メンバー名を順番に表示)
  - カード形式のレンダリング(チームごとにカード UI、Flexbox/Grid レイアウト)
  - チーム番号またはチーム名の表示
  - メンバー名の明確な表示
  - 表示形式切り替えボタン(リスト ⇔ カード)
  - CSS スタイル適用(青色基調、シンプル・ミニマルデザイン)
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 8.1, 8.2_

- [ ] 5.2 再抽選ボタン機能を実装

  - 再抽選ボタンの HTML 要素を作成
  - チーム分け結果表示後にボタンを表示
  - ボタンクリック時に AppController.reExecuteTeamAssignment()を呼び出し
  - 前回の設定で即座に新しいチーム分けを実行
  - 結果を上書き表示(DOM 更新)
  - _Requirements: 6.1, 6.2, 6.3, 8.4_

- [ ] 6. 画像保存機能
- [ ] 6.1 ImageExporter コンポーネントを実装

  - exportAsImage()でチーム結果を画像化
  - createCanvas()で Canvas 要素を動的に生成
  - drawTeams()で Canvas 2D コンテキストにチーム情報を描画(チーム名、メンバー名、日本語フォント対応)
  - canvasToDataURL()で PNG 形式の Data URL を生成
  - triggerDownload()でダウンロードリンク作成とクリックトリガー(タイムスタンプ付きファイル名: teams-YYYYMMDD-HHMMSS.png)
  - Canvas 描画のレイアウト設計(視認可能なフォントサイズ、適切な余白)
  - _Requirements: 7.2, 7.3, 7.4_

- [ ] 6.2 画像保存ボタン UI を実装

  - 「画像保存」ボタンの HTML 要素を作成
  - チーム分け結果表示後にボタンを表示
  - ボタンクリック時に AppController.exportImage()を呼び出し
  - ImageExporter.exportAsImage()実行とエラーハンドリング
  - 成功時のフィードバック表示(任意、トースト通知など)
  - 失敗時のエラーメッセージ表示
  - _Requirements: 7.1, 7.2, 7.3, 8.4_

- [ ] 7. エラーハンドリングとバリデーション強化
- [ ] 7.1 入力バリデーションを実装

  - メンバー名の空文字列チェック(1 文字以上)
  - チーム数の正の整数バリデーション(1 以上、メンバー数以下)
  - 1 チーム人数の正の整数バリデーション(1 以上、メンバー数以下)
  - 制約条件の整合性チェック(該当メンバー数以上の制約人数禁止)
  - リアルタイムバリデーション(入力時のエラー表示)
  - _Requirements: 1.3, 2.1, 3.1, 4.1, 4.2_

- [ ] 7.2 グローバルエラーハンドラを実装

  - window.onerror で JavaScript 例外をキャッチ
  - Result 型のエラーを統一的に処理
  - SessionStorage 制限超過エラーのハンドリング
  - Canvas API 失敗のハンドリング
  - ユーザーフレンドリーなエラーメッセージ表示(モーダルまたはトースト)
  - コンソールへのエラーログ出力
  - _Requirements: 10.1_

- [ ] 8. 統合とポリッシング
- [ ] 8.1 コンポーネント統合とエンドツーエンドフロー検証

  - 全コンポーネントの AppController への統合
  - メンバー管理 → チーム分け → 結果表示 → 画像保存の完全なフローテスト
  - SessionStorage の状態管理検証(ページリロード時の復元)
  - エラーハンドリングの統合テスト
  - 各種バリデーションの動作確認
  - _Requirements: 全要件_

- [ ] 8.2 レスポンシブデザインと UI/UX 最適化

  - モバイル(320px-768px)、タブレット(768px-1024px)、デスクトップ(1024px+)のレイアウト調整
  - タッチデバイス対応(ボタンサイズ、タップターゲット)
  - フォントサイズとコントラストの視認性確認
  - 青色基調のカラーテーマの一貫性確認
  - アニメーションなしの即座表示動作確認
  - ワンクリック操作の確認
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [ ]\* 8.3 受入基準に基づくテストケース実行

  - 要件 1: 初期メンバー 10 人表示、メンバー追加/編集/削除
  - 要件 2: チーム数指定(3 チーム、端数あり/なし)
  - 要件 3: 1 チーム人数指定(4 人ずつ、端数あり/なし)
  - 要件 4: 制約付き(ひらがな 3 人チーム、残り分配)
  - 要件 5: リスト/カード形式での結果表示
  - 要件 6: 再抽選で異なる結果
  - 要件 7: PNG 画像ダウンロード、ファイル名タイムスタンプ
  - 要件 8: UI/UX デザイン(シンプル、青色、即座表示)
  - 要件 10: SessionStorage のみでのデータ管理
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 7.1, 7.2, 7.3, 7.4, 8.1, 8.2, 8.3, 8.4, 10.1, 10.2, 10.3, 10.4_

- [ ] 9. GitHub Pages デプロイ準備
- [ ] 9.1 デプロイメント構成とドキュメント作成
  - README.md にアプリ概要、使用方法、技術スタック、デプロイ手順を記載
  - リポジトリルートに index.html, style.css, app.js を配置確認
  - GitHub Pages 設定手順のドキュメント化
  - ブラウザ互換性情報の記載(Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
  - _Requirements: 9.1, 9.2, 9.3_
